<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cornhole Match Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --accent: #38bdf8;
      --text: #e2e8f0;
      --muted: #94a3b8;
      --danger: #f97316;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1f2937 0%, #020617 60%);
      color: var(--text);
      min-height: 100vh;
      padding: 1.5rem;
    }
    h1 {
      text-align: center;
      margin-bottom: 1rem;
      letter-spacing: .02em;
    }
    .container {
      max-width: 1100px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 1.4fr;
      gap: 1.5rem;
    }
    .card {
      background: rgba(2, 6, 23, 0.45);
      border: 1px solid rgba(148, 163, 184, 0.12);
      border-radius: 1rem;
      padding: 1rem 1.25rem 1.25rem;
      backdrop-filter: blur(10px);
    }
    label {
      font-size: .75rem;
      text-transform: uppercase;
      letter-spacing: .03em;
      color: var(--muted);
      display: block;
      margin-bottom: .25rem;
    }
    input, textarea {
      width: 100%;
      background: rgba(15, 23, 42, 0.4);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: .5rem;
      padding: .4rem .6rem .45rem;
      color: var(--text);
      outline: none;
      font-size: .85rem;
    }
    input:focus, textarea:focus {
      border-color: var(--accent);
    }
    .row {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: .65rem;
      margin-bottom: .65rem;
    }
    .team-box {
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: .75rem;
      padding: .5rem .6rem .65rem;
      background: rgba(15, 23, 42, 0.3);
    }
    .team-title {
      font-weight: 600;
      margin-bottom: .35rem;
    }
    button {
      background: var(--accent);
      border: none;
      border-radius: .5rem;
      padding: .5rem .75rem;
      color: #0f172a;
      font-weight: 600;
      cursor: pointer;
    }
    button.secondary {
      background: rgba(148, 163, 184, 0.07);
      color: var(--text);
    }
    button.danger {
      background: rgba(249, 115, 22, 0.15);
      color: #fff;
      border: 1px solid rgba(249, 115, 22, 0.5);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: .5rem;
      font-size: .78rem;
    }
    th, td {
      border-bottom: 1px solid rgba(148, 163, 184, 0.1);
      padding: .35rem .35rem .45rem;
      text-align: left;
      vertical-align: top;
    }
    th {
      font-size: .7rem;
      text-transform: uppercase;
      letter-spacing: .03em;
      color: var(--muted);
    }
    .score-badge {
      display: inline-block;
      background: rgba(56, 189, 248, 0.15);
      border: 1px solid rgba(56, 189, 248, 0.3);
      padding: .15rem .4rem;
      border-radius: .35rem;
      font-weight: 600;
      font-size: .68rem;
    }
    .winner {
      color: #facc15;
      font-weight: 600;
      font-size: .68rem;
      display: inline-block;
      margin-right: .4rem;
    }
    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: .5rem;
    }
    .empty {
      text-align: center;
      color: var(--muted);
      padding: 1rem 0 0.3rem;
      font-size: .8rem;
    }
    @media (max-width: 960px) {
      .container { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <h1>Cornhole Match Tracker ðŸŸ¦ðŸŸ§</h1>
  <div class="container">
    <div class="card">
      <h2 style="margin-top:0;">New Match</h2>
      <p style="font-size:.75rem; color:var(--muted); margin-top:-.3rem; margin-bottom:.75rem;">
        Enter teams, players, and scores. PIN required to save.
      </p>
      <div class="row">
        <div>
          <label for="teamAName">Team A Name</label>
          <input id="teamAName" placeholder="e.g. Boards & Brews" />
        </div>
        <div>
          <label for="teamBName">Team B Name</label>
          <input id="teamBName" placeholder="e.g. Bag Tossers" />
        </div>
      </div>
      <div class="row">
        <div class="team-box">
          <div class="team-title">Team A Players</div>
          <textarea id="teamAPlayers" rows="2" placeholder="One line or comma-separated&#10;e.g. Mike, Jess"></textarea>
        </div>
        <div class="team-box">
          <div class="team-title">Team B Players</div>
          <textarea id="teamBPlayers" rows="2" placeholder="e.g. Chris, Sam"></textarea>
        </div>
      </div>
      <div class="row">
        <div>
          <label for="teamAScore">Team A Score</label>
          <input type="number" id="teamAScore" min="0" max="21" placeholder="21" />
        </div>
        <div>
          <label for="teamBScore">Team B Score</label>
          <input type="number" id="teamBScore" min="0" max="21" placeholder="15" />
        </div>
      </div>
      <div class="row">
        <div>
          <label for="location">Location / Notes</label>
          <input id="location" placeholder="Backyard, League Night..." />
        </div>
        <div>
          <label for="date">Date/Time</label>
          <input id="date" type="datetime-local" />
        </div>
      </div>
      <button id="saveMatchBtn" style="margin-top:.5rem;">Save Match</button>
      <button id="clearAllBtn" class="danger" style="margin-top:.5rem; float:right;">Clear All</button>
    </div>
    <div class="card">
      <div class="topbar">
        <h2 style="margin:0;">Match History</h2>
        <small id="matchCount" style="color:var(--muted);"></small>
      </div>
      <table id="historyTable">
        <thead>
          <tr>
            <th>Date</th>
            <th>Teams / Players</th>
            <th>Score</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody id="historyBody"></tbody>
      </table>
      <div id="emptyState" class="empty" style="display:none;">No matches yet â€” add your first one!</div>
    </div>
  </div>

  <script>
    // ===== JSONBin Configuration =====
    const BIN_ID = "691c953743b1c97be9b53d78";
    const API_KEY = "$2a$10$pR2xuZ4yCudHQPF8CwIm6eW7HyuW3t5iPaKvws50HmuoexpwaUtNu"; 
    const requiredPin = "0340";

    // ===== JSONBin Functions =====
    async function loadMatches() {
      try {
        const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
          headers: { "X-Master-Key": API_KEY }
        });
        const data = await res.json();
        return data.record?.matches || [];
      } catch (err) {
        console.error("Error loading from JSONBin:", err);
        return [];
      }
    }

    async function saveMatches(matches) {
      try {
        const body = { matches };
        await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
            "X-Master-Key": API_KEY
          },
          body: JSON.stringify(body)
        });
      } catch (err) {
        console.error("Error saving to JSONBin:", err);
      }
    }

    // ===== Render Matches =====
    function renderMatches() {
      loadMatches().then(matches => {
        const tbody = document.getElementById("historyBody");
        const empty = document.getElementById("emptyState");
        const count = document.getElementById("matchCount");
        tbody.innerHTML = "";
        if (!matches.length) {
          empty.style.display = "block";
          count.textContent = "0 matches";
          return;
        }
        empty.style.display = "none";
        count.textContent = matches.length + (matches.length === 1 ? " match" : " matches");
        matches.sort((a, b) => new Date(b.dateTime) - new Date(a.dateTime)).forEach(match => {
          const tr = document.createElement("tr");
          const d = new Date(match.dateTime);
          const dateTd = document.createElement("td");
          dateTd.textContent = d.toLocaleString();
          tr.appendChild(dateTd);
          const teamsTd = document.createElement("td");
          teamsTd.innerHTML = `
            <div><strong>${match.teamA.name}</strong> 
            <small style="color:#94a3b8">(${match.teamA.players.join(", ") || "â€”"})</small></div>
            <div><strong>${match.teamB.name}</strong> 
            <small style="color:#94a3b8">(${match.teamB.players.join(", ") || "â€”"})</small></div>
          `;
          tr.appendChild(teamsTd);
          const scoreTd = document.createElement("td");
          const a = match.teamA.score, b = match.teamB.score;
          let winner = "";
          if (a > b) winner = match.teamA.name;
          else if (b > a) winner = match.teamB.name;
          else winner = "Tie";
          scoreTd.innerHTML = `<div><span class="winner">${winner}</span><br/><span class="score-badge">${a} - ${b}</span></div>`;
          tr.appendChild(scoreTd);
          const notesTd = document.createElement("td");
          notesTd.textContent = match.notes || "â€”";
          tr.appendChild(notesTd);
          tbody.appendChild(tr);
        });
      });
    }

    // ===== Events =====
    document.addEventListener("DOMContentLoaded", () => {
      const dateInput = document.getElementById("date");
      const now = new Date();
      dateInput.value = new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
      renderMatches();

      document.getElementById("saveMatchBtn").addEventListener("click", async () => {
        const enteredPin = prompt("Enter PIN to save match:");
        if (enteredPin !== requiredPin) {
          alert("Incorrect PIN â€” match not saved.");
          return;
        }

        const teamAName = document.getElementById("teamAName").value.trim() || "Team A";
        const teamBName = document.getElementById("teamBName").value.trim() || "Team B";
        const teamAPlayers = document.getElementById("teamAPlayers").value.trim();
        const teamBPlayers = document.getElementById("teamBPlayers").value.trim();
        const teamAScore = parseInt(document.getElementById("teamAScore").value || "0", 10);
        const teamBScore = parseInt(document.getElementById("teamBScore").value || "0", 10);
        const notes = document.getElementById("location").value.trim();
        const dateTime = document.getElementById("date").value || new Date().toISOString();

        const match = {
          id: crypto.randomUUID ? crypto.randomUUID() : Date.now().toString(),
          dateTime,
          teamA: {
            name: teamAName,
            players: teamAPlayers ? teamAPlayers.split(",").map(p => p.trim()).filter(Boolean) : [],
            score: teamAScore
          },
          teamB: {
            name: teamBName,
            players: teamBPlayers ? teamBPlayers.split(",").map(p => p.trim()).filter(Boolean) : [],
            score: teamBScore
          },
          notes
        };

        const matches = await loadMatches();
        matches.push(match);
        await saveMatches(matches);
        renderMatches();
        document.getElementById("teamAScore").value = "";
        document.getElementById("teamBScore").value = "";
      });

      document.getElementById("clearAllBtn").addEventListener("click", async () => {
        if (confirm("Delete all saved matches?")) {
          await saveMatches([]);
          renderMatches();
        }
      });
    });
  </script>
</body>
</html>
